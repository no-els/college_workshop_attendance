<template>
  <!-- Launcher button -->
  <lightning-button
    label="New Workshop Series"
    title="Create a new Workshop Series"
    onclick={openModal}
    variant="brand"
  ></lightning-button>

  <!-- Modal -->
  <template if:true={isOpen}>
    <section
      role="dialog"
      aria-modal="true"
      aria-labelledby="ws-modal-heading"
      class="slds-modal slds-fade-in-open"
      onkeydown={handleKeydown}
    >
      <div class="slds-modal__container">
        <!-- Header -->
        <header class="slds-modal__header">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                  title="Close" onclick={closeModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="ws-modal-heading" class="slds-text-heading_medium">
            New Workshop Series
          </h2>
        </header>

        <!-- Body -->
        <div class="slds-modal__content slds-p-around_medium">
          <template if:true={isSubmitting}>
            <lightning-spinner alternative-text="Saving"></lightning-spinner>
          </template>

          <lightning-record-edit-form
            object-api-name="Workshop_Series__c"
            onsuccess={handleSuccess}
            onerror={handleError}
            onload={handleLoad}
            onsubmit={handleSubmit}
            data-id="form"
          >
            <!-- Fields you want on create -->
            <lightning-input-field field-name="Name" required></lightning-input-field>

            <!-- New: School Year picklist (defaults set in JS) -->
            <lightning-input-field field-name="School_Year__c" required data-id="school-year"></lightning-input-field>
            
            <!-- Program field hidden - set automatically in background -->
            <lightning-input-field field-name="Program__c" value={defaultProgram} class="slds-hide"></lightning-input-field>

            <!-- Owner defaults to current user; include if you want to expose it -->
            <!-- <lightning-input-field field-name="OwnerId"></lightning-input-field> -->
          </lightning-record-edit-form>
        </div>

        <!-- Footer -->
        <footer class="slds-modal__footer slds-grid slds-grid_align-end slds-gap_small">
          <lightning-button variant="neutral" label="Cancel" onclick={closeModal}></lightning-button>
          <lightning-button variant="brand" label="Save" onclick={submitForm}></lightning-button>
        </footer>
      </div>
    </section>

    <!-- Backdrop (click to close) -->
    <div class="slds-backdrop slds-backdrop_open" onclick={closeModal}></div>
  </template>
</template>